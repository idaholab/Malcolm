filter {

  if ([log_source] == "sv") {
    #############################################################################################################################
    # sv.log
    # main.zeek ()

    if ("_jsonparsesuccess" not in [tags]) {
      dissect {
        id => "dissect_zeek_sv"
        mapping => {
          "[message]" => "%{[zeek_cols][ts]} %{[zeek_cols][appid]} %{[zeek_cols][length]} %{[zeek_cols][smpcnt]} %{[zeek_cols][sv_id]}"
        }
      }

      if ("_dissectfailure" in [tags]) {
        mutate {
          id => "mutate_split_zeek_sv"
          split => { "[message]" => " " }
        }
        ruby {
          id => "ruby_zip_zeek_sv"
          init => "@zeek_sv_field_names = [ 'ts', 'appid', 'length', 'smpcnt', 'sv_id' ]"
          code => "event.set('[zeek_cols]', @zeek_sv_field_names.zip(event.get('[message]')).to_h)"
        }
      }
    }

    mutate {
      id => "mutate_add_fields_zeek_sv"
      add_field => {
        "[zeek_cols][service]" => "iec61850_sv"
      }
      add_tag => [ "ics" ]

    }
  }

}